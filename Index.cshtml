@model IEnumerable<Event>
@{
    ViewData["Title"] = "All Events";
    var categories = ViewBag.Categories as List<Category>;
}

<h1 class="text-center mb-4">üé´ All Events</h1>

<!-- Search Box (AJAX Live Search) -->
<div class="mb-3">
    <input type="text" id="searchBox" class="form-control" placeholder="Search events..." />
</div>

<div class="d-flex justify-content-between mb-3">
    <a asp-action="Create" class="btn btn-primary">+ Add New Event</a>
</div>

<!-- Results container (AJAX updates this) -->
<div id="eventResults">
    @await Html.PartialAsync("_EventPartial", Model)
</div>

@section Scripts {
    <script>
        $(document).ready(function () {

            $("#searchBox").on("keyup", function () {
                var query = $(this).val();

                $.ajax({
                    url: '@Url.Action("Search", "Events")',
                    type: 'GET',
                    data: { term: query },   // ‚Üê FIXED HERE
                    success: function (result) {
                        $("#eventResults").html(result);
                    }
                });
            });

            // ADD TO CART HANDLER
            $(document).on("click", ".addToCartBtn", function () {
                var id = $(this).data("id");

                $.ajax({
                    url: "/Cart/AddToCart",
                    type: "POST",
                    data: {
                        eventId: id,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function (result) {
                        $("#cartCount").text(result.totalQuantity);
                    }
                });
            });

        });
    </script>
    
}